import { useState } from "react";
import { Ending } from "./Ending.jsx";

const Game = () => {
  const [step, setStep] = useState(1);
  const [ending, setEnding] = useState(null);

  const handleOptionClick = (nextStep) => {
    const nextStepData = steps[nextStep];
    if (nextStepData?.ending) {
      setEnding(nextStepData.ending);
    } else if (nextStepData) {
      setStep(nextStep);
    } else {
      console.error(`Крок ${nextStep} не знайдено!`);
      setEnding({
        type: "Помилка",
        text: "Крок не знайдено. Спробуйте перезавантажити гру.",
      });
    }
  };

  const steps = {
    // Крок 1: Початок лісу
    1: {
      text: "Темрява швидко настає, і перед тобою два шляхи: вузька, заросла стежка та стара ґрунтова дорога.",
      options: [
        { text: "Іти зарослою стежкою", nextStep: 2.1 },
        { text: "Іти ґрунтовою дорогою", nextStep: 2.2 },
      ],
    },

    // Крок 2: Символи та покинутий табір
    // Якщо вибрали 1.1
    2.1: {
      text: "Ти йдеш зарослою стежкою і раптом помічаєш дивні символи, вирізьблені на стовбурах дерев. Вони здаються частиною якогось древнього обряду.",
      options: [
        { text: "Ігнорувати символи і продовжити йти далі", nextStep: 3.1 },
        {
          text: "Доторкнутися до символів, намагаючись зрозуміти їх значення",
          nextStep: 3.2,
        },
      ],
    },
    // Якщо вибрали 1.2
    2.2: {
      text: "Ти йдеш ґрунтовою дорогою і знаходиш залишки старого табору. Серед порваного одягу та зламаних речей ти знаходиш компас.",
      options: [
        { text: "Взяти компас", nextStep: 3.3 },
        { text: "Залишити компас і продовжити шлях", nextStep: 3.4 },
      ],
    },

    // Крок 3: Зустріч із жінкою в чорному
    // Якщо вибрали 2.1
    3.1: {
      text: "Ти вирішуєш не чіпати символи, але з часом починаєш відчувати, що за тобою спостерігають. Раптом ти бачиш жінку в чорному плащі.",
      options: [
        { text: "Заговорити з нею", nextStep: 4.1 },
        { text: "Обійти її і йти далі", nextStep: 4.2 },
      ],
    },
    // Якщо вибрали 2.2
    3.2: {
      text: "Ти доторкаєшся до символів, і тебе пронизує дивне відчуття. Чутно шепіт, і на стежці попереду з’являється жінка в чорному.",
      options: [
        { text: "Заговорити з нею", nextStep: 4.1 },
        {
          text: "Ігнорувати її та продовжити йти",
          nextStep: 4.2,
        },
      ],
    },
    // Якщо вибрали 2.3
    3.3: {
      text: "Ти береш компас і відчуваєш себе впевненіше. Однак, незабаром на дорозі з’являється жінка в чорному.",
      options: [
        { text: "Запитати її про хатинку", nextStep: 4.5 },
        { text: "Пройти повз і не звертати уваги", nextStep: 4.2 },
      ],
    },
    // Якщо вибрали 2.4
    3.4: {
      text: "Ти залишаєш компас і продовжуєш йти. Незабаром з’являється жінка в чорному, яка пильно дивиться на тебе.",
      options: [
        { text: "Заговорити з нею", nextStep: 4.7 },
        { text: "Обійти і йти далі", nextStep: 4.2 },
      ],
    },

    // Крок 4: Вибір шляху до хатинки
    // Якщо вибрали 3.1, 3.3, 3.5, 3.7
    4.1: {
      text: "Жінка вказує на два шляхи до хатинки: короткий, але темний і небезпечний, та довший, який обходить основну частину лісу.",
      options: [
        { text: "Обрати короткий шлях", nextStep: 5.1 },
        { text: "Обрати довгий шлях", nextStep: 5.2 },
      ],
    },
    // Якщо вибрали 3.2, 3.4, 3.6, 3.8
    4.2: {
      text: "Ти ігноруєш жінку і продовжуєш свій шлях, але бачиш два шляхи попереду: один короткий і небезпечний, а другий довший і спокійніший.",
      options: [
        { text: "Обрати короткий шлях", nextStep: 5.1 },
        { text: "Обрати довгий шлях", nextStep: 5.2 },
      ],
    },

    // Крок 5: Хатинка та дзеркало
    // Якщо вибрали 4.1 або 4.3
    5.1: {
      text: "Ти приходиш до хатинки швидше, але навколо тебе помітно згущуються тіні. Входячи всередину, бачиш велике дзеркало.",
      options: [
        { text: "Подивитися в дзеркало", nextStep: 6.1 },
        { text: "Ігнорувати дзеркало та оглянути інші кімнати", nextStep: 6.2 },
      ],
    },
    // Якщо вибрали 4.2 або 4.4
    5.2: {
      text: "Ти обираєш довгий шлях і повільно підходиш до хатинки. Вона здається пустою, але всередині є дзеркало на стіні.",
      options: [
        { text: "Подивитися в дзеркало", nextStep: 6.1 },
        { text: "Обійти дзеркало і піти до іншої кімнати", nextStep: 6.2 },
      ],
    },

    // Крок 6: Дзеркало та шум із підвалу
    // Якщо вибрали 5.1 або 5.3
    6.1: {
      text: "Ти дивишся в дзеркало і бачиш сцену з минулого, де попередні гості хатинки не змогли знайти виходу. З підвалу доноситься шурхіт, ніби хтось там є.",
      options: [
        { text: "Спуститися в підвал, щоб перевірити", nextStep: 7.1 },
        { text: "Ігнорувати шум і залишити хатинку", nextStep: 7.2 },
      ],
    },
    // Якщо вибрали 5.2 або 5.4
    6.2: {
      text: "Ти ігноруєш дзеркало і вирішуєш дослідити інші кімнати хатинки, але раптово чуєш дивний звук з підвалу.",
      options: [
        { text: "Спуститися в підвал, щоб перевірити", nextStep: 7.3 },
        { text: "Ігнорувати шум і вийти з хатинки", nextStep: 7.4 },
      ],
    },

    // Крок 7: Кінцівка гри
    7.1: {
      text: "Ти спускаєшся в підвал і знаходиш дивний старий артефакт. Раптом двері закриваються, і ти більше не можеш вибратись.",
      ending: {
        type: "Кінець 1",
        text: "Ти не зміг вибратися з підвалу і став частиною цього місця.",
      },
    },
    7.2: {
      text: "Ти залишаєш хатинку і виходиш з лісу, але його таємниці назавжди залишаються з тобою.",
      ending: {
        type: "Кінець 2",
        text: "Ти вибрався, але ліс залишиться в твоїй пам'яті назавжди.",
      },
    },
    7.3: {
      text: "Ти спускаєшся в підвал і знаходиш темну кімнату з численними дверима. Обираючи одну з них, ти знаходиш вихід, але він веде до іншого світу.",
      ending: {
        type: "Кінець 3",
        text: "Ти знайшов вихід, але цей світ не був твоїм.",
      },
    },
    7.4: {
      text: "Ти не спустився в підвал і вирішив покинути ліс, шукаючи нову дорогу.",
      ending: {
        type: "Кінець 4",
        text: "Ти пішов, і ліс більше не міг завадити тобі на твоєму шляху.",
      },
    },
  };

  return (
    <div className="game-container">
      {ending ? (
        <div className="ending-text">
          <div className="ending-type">{ending.type}</div>
          <p>{ending.text}</p>
        </div>
      ) : (
        <div>
          <p className="fade-in">{steps[step].text}</p>
          {steps[step].options.map((option, index) => (
            <button
              key={index}
              className="button-appear"
              onClick={() => handleOptionClick(option.nextStep)}
            >
              {option.text}
            </button>
          ))}
        </div>
      )}
    </div>
  );
};

export default Game;
